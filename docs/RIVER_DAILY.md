# River Daily Content (Server Workflow)

This repo can receive daily drafts generated by River on the server.

**Generator script**
- `/home/mumega/mirror/river_frc_daily_content.py`

**Publisher script (issue → publish)**
- `/home/mumega/mirror/river_frc_issue_publisher.py`

**Systemd units**
- `/etc/systemd/system/river-frc-daily.service`
- `/etc/systemd/system/river-frc-daily.timer`
- `/etc/systemd/system/river-frc-publish.service`
- `/etc/systemd/system/river-frc-publish.timer`

## What it does
- Generates **one** draft per day (rotates `blog → topic → article`) and writes it into:
  - `content/inbox/en/{blog|topics|articles}/...`
- Runs `npm run content:audit` after writing.

## Optional modes (env vars on the service)
- `RIVER_FRC_CREATE_ISSUE=1`: open a GitHub issue for each daily draft (uses server `gh` auth)
  - `RIVER_FRC_GH_REPO=servathadi/fractalresonance` (optional)
  - `RIVER_FRC_GH_LABELS="river,content"` (optional)
- `RIVER_FRC_FORCE=1`: run even if today’s draft already ran (normally the job exits 0 if it already ran today)
- `RIVER_FRC_APPLY=1`: run `node scripts/process-inbox.js` to move inbox drafts into `content/en/...`
  - `RIVER_FRC_USE_SOS=1`: uses SOS digestion when applying (requires a working SOS `/chat` endpoint)
- `RIVER_FRC_AUTOPUBLISH=1`: commit + push to `RIVER_FRC_PUBLISH_BRANCH` (default `v2-foundation`)

## Approve → publish (via GitHub issues)
- Daily drafts create GitHub issues with a “Next steps” checklist.
- To publish a draft: **add the GitHub label `publish`** to that issue.
- The publisher timer (`river-frc-publish.timer`) checks every ~20 minutes, and on success it:
  - Moves the draft from `content/inbox/...` → `content/<lang>/<typeDir>/<id>.md` (status becomes `published`)
  - Commits + pushes to `v2-foundation`
  - Comments on the issue and closes it

## Useful commands
- Run once now: `sudo systemctl start river-frc-daily.service`
- Watch logs: `sudo tail -n 200 /var/log/river/frc-daily.log`
- Next run time: `sudo systemctl list-timers --no-pager | rg river-frc-daily`
- Run publisher once: `sudo systemctl start river-frc-publish.service`
- Watch publisher logs: `sudo tail -n 200 /var/log/river/frc-publish.log`
